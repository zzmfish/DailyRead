<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>statically-configure-a-firewall-to-let-omg-dds-traffic-through | 每日阅读</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="statically-configure-a-firewall-to-let-omg-dds-traffic-through" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Statically configure a Firewall to let OMG DDS Traffic through" />
<meta property="og:description" content="Statically configure a Firewall to let OMG DDS Traffic through" />
<link rel="canonical" href="https://zzmfish.github.io/DailyRead/2021/01/15/statically-configure-a-firewall-to-let-omg-dds-traffic-through.html" />
<meta property="og:url" content="https://zzmfish.github.io/DailyRead/2021/01/15/statically-configure-a-firewall-to-let-omg-dds-traffic-through.html" />
<meta property="og:site_name" content="每日阅读" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="statically-configure-a-firewall-to-let-omg-dds-traffic-through" />
<script type="application/ld+json">
{"@type":"BlogPosting","description":"Statically configure a Firewall to let OMG DDS Traffic through","url":"https://zzmfish.github.io/DailyRead/2021/01/15/statically-configure-a-firewall-to-let-omg-dds-traffic-through.html","headline":"statically-configure-a-firewall-to-let-omg-dds-traffic-through","dateModified":"2021-01-15T00:00:00+08:00","datePublished":"2021-01-15T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://zzmfish.github.io/DailyRead/2021/01/15/statically-configure-a-firewall-to-let-omg-dds-traffic-through.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/DailyRead/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://zzmfish.github.io/DailyRead/feed.xml" title="每日阅读" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/DailyRead/">每日阅读</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/DailyRead/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">statically-configure-a-firewall-to-let-omg-dds-traffic-through</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-01-15T00:00:00+08:00" itemprop="datePublished">Jan 15, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="statically-configure-a-firewall-to-let-omg-dds-traffic-through">Statically configure a Firewall to let OMG DDS Traffic through</h1>

<p>There are various strategies that can be used to have DDS applications communicate between each other <code class="language-plaintext highlighter-rouge">despite</code> the fact that one or more of these applications are protected by a firewall.</p>

<p>尽管应用程序可能被防火墙隔离，还是有多种策略可以让DDS应用程序彼此通讯。</p>

<p>This HOWTO focuses in the situation where there is a desire to use static configuration (i.e. manually open specific ports or multicast addresses in the firewall) and the applications are protected with Firewalls but are not behind Network Address Translators (NATs). In other words the IP of one computer is reachable from the other directly (assuming the Firewall forwards the traffic).</p>

<h2 id="background-ports-used-by-dds-discovery">Background: Ports used by DDS Discovery</h2>

<p>The ports (and multicast addresses) used by DDS implementations (such as RTI Connext DDS) are specified by the <a href="http://www.omg.org/spec/DDS-RTPS/">OMG DDS Interoperability Wire Protocol Specification (DDS-RTPS)</a>.By default, each DomainParticipant opens 4 UDP/IP ports: Two of those ports are multicast ports which are shared among all domain participants in the same DomainId. The other two are unicast ports which are different for each participant within a computer. The multicast IP address used for discovery is 239.255.0.1 by default consistent which the DDS-RTPS specification.</p>

<p>The ports used are given by a formula that depends on the DDS domainId and the number of participants that are already running on the same operating system instance (computer or virtual machines):</p>

<p>Multicast Ports (common to all applications on a domainId):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DiscoveryMulticastPort  =   PB + DG * domainId + d0
UserMulticastPort    =   PB + DG * domainId + d2
</code></pre></div></div>

<p>Unicast Ports (different for each participant running on a single operating system instance. Computer or VM):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DiscoveryUnicastPort    =   PB + DG * domainId + d1 + PG * participantId
UserUnicastPort         =   PB + DG * domainId + d3 + PG * participantId
</code></pre></div></div>

<p>These formulas are depend on two variables: domainId and participantId</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>domainId      - Is the DDS domainId
participantId - Is an integer starting at 0 that enumerates each participant 
                that runs on a given operating system instance (computer 
                or virtual machine). 
                The first participant will be 0, the second 1, etc.
</code></pre></div></div>

<p>The formulas are parameterized by the constants d0, d1, d2, d3, PB, DG, and PG which are all defined in the OMG DDS Interoperability Wire Protocol Specification (DDS-RTPS) as follows:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>d0  (builtin_multicast_port_offset)    = 0
d2  (user_multicast_port_offset)       = 1 
d1  (builtin_unicast_port_offset)      = 10
d3  (user_unicast_port_offset)         = 11
PB  (port_base)             = 7400
DG ( domain_id_gain)        = 250
PG  (participant_id_gain)   = 2
</code></pre></div></div>

<p>For example, assuming you are running in domainId=0 (the default), if you have two participants running in the computer, then the ports used will be:</p>

<p>All applications:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DiscoveryMulticastPort  = 7400
UserMulticastPort       = 7401
</code></pre></div></div>

<p>First application:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DiscoveryUnicastPort    = 7410
UserUnicastPort         = 7411
</code></pre></div></div>

<p>Second application:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DiscoveryUnicastPort    = 7412
UserUnicastPort         = 7413
</code></pre></div></div>

<p>So if the maximum number of participants that will be running on the computer is 2, you need to open the following ports in the firewall: 7400, 7401, 7410, 7411, 7412, 7413 You can download this <a href="http://community.rti.com/filedepot?cid=11&amp;fid=14">Spreadsheet UDP Ports Used by OMG DDS</a> to compute which ports will be open for a specific domainId and participantId.</p>

<p>It should be noted that the above formulas are for the default setup which complies with the OMG DDS Interoperability Wire Protocol. In addition to this RTI Connext DDS allows integrators to change the port mappings to fit specific deployment scenario. This is done using the WireProtocolQosPolicy within the DomainParticipantQos</p>

<p>Specifically the member rtps_well_known_ports within the <a href="http://community.rti.com/rti-doc/500/ndds.5.0.0/doc/html/api_cpp/structDDS__WireProtocolQosPolicy.html">WireProtocolQosPolicy</a> allows an application to override the default settings for all the above constants. Note that if this Qos Policy is changed, then it must be done consistently on all the DomainParticipants within the DDS Domain or else they will not discover each other.</p>

<h2 id="opening-firewall-ports">Opening firewall ports</h2>

<p>If your firewall configuration supports opening multicast addresses for given ports as well as opening ports without specifying a particular IP where to redirect the packets received on that port then taking advanatge of this feature is often the simplest thing to do.</p>

<p>First use the <a href="http://community.rti.com/filedepot?cid=11&amp;fid=14">Spreadsheet UDP Ports Used by OMG DDS</a> to determine which ports you need to open based on the domainId (or domainIds) that will be communicating across the firewall and the maximum number of participants that you will ever have running on a a single computer on that domain Id. If you are unsure of this number just use the maximum of 120 participants (participantId 0-119).</p>

<p>For example if we will be communicating on domainId=0 and we want to open ports for any number of participants per computer (up to the maximum), then we would open the UDP range 7400-7649 (both included). 7400 is the lowest UDP port used when participantId=0 and 7649 is the highest one used when participantId=119</p>

<p>If we wanted the same only for domainId=10, then we would open UDP ports 9900-10149.</p>

<p>In addition to the above you also need to configure the firewall to forward multicast packets on the multicast address 239.255.0.1 for the multicast ports in the domainId that you plan to use. For example if you are using domainId=0, you need to configure that multicast address to be open on UDP ports 7400 and 7401. If yiu are using domainId=10 it would be UDP ports 9900 amd 9901.</p>

<h2 id="setting-port-forwarding-rules-in-the-firewall-or-firewalls-that-do-not-support-multicast">Setting port-forwarding rules in the firewall or firewalls that do not support multicast</h2>

<p>Some firewalls do not allow ports to simply be open such that packets can reach any computer behind the firewall. Rather they only allow ports to be forwarded where all IP packets reaching the firewall on that port are forwarded to a specific IP address (and port number) behind the firewall. Other firewalls cannot be configured to forward multicast IP packets.</p>

<p>If you have this kind of firewall and you are planning to run DDS on more than one computer behind the firewall then you face a problem. The packets forwarded by the firewall on a particular port can only go to one destination so it would not be possible to reach all the computers behind the firewall.</p>

<p>The solution to this scenario is to deploy a RTI DDS Routing Service behind the Firewall. The RTI DDS Routing Service acts as proxy for all the computers that run DDS behind the firewall. The Firewall is configured to forward all traffic on the DDS ports to the RTI DDS Routing Service and this application will then relay it to their intended destinations.</p>

<p>The RTI DDS Routing Service can be configured to automatically relay all traffic between two domains, or to do it only for certain DDS Topics, or packets with specific content on a Topic, giving you additional control over which data flows in and out of the Firewall via DDS.</p>

<p>The RTI DDS Routing Service will have two DomainParticipants each with its own domainId. One domainId is used to communicate with the applications outside the firewall and the other with the applications inside. Since all the DDS traffic from the firewall is forwarded to the Participant in the RTI DDS Routing Service that is using the domainId chosen for the “outside-the-firewall” configuration you only need to forward the ports that domainId.</p>

<p>For example, assume we choose domainId=0 to be our “outside the firewall” domain and domainId=1 for the applications behind the firewall. Then we just need to forward the ports to a single participant running on domainId=0 (the one inside RTI DDS Routing Service) so this only necessitates opening ports 7400-7411 (both included).</p>

<p>The above assumes you will only one instance of the RTI DDS Routing Service, which is the normal case. If you wanted to run multiple instances on the same computer, for example to a redundant scenario or a load-balancing scenario, then you would have t take that into consideration when computing the range of ports that should be forwarded.</p>

<h2 id="reaching-applications-behing-a-firewall-with-a-nat">Reaching applications behing a firewall with a NAT</h2>

<p>If the firewall also has a Network Address Translators (NATs), then the IP addresses of any computer inside the firewall are not directly reachable outside the firewall. This scenario is also supported using the RTI DDS Routing Service but the setup will be explained in a separate HOWTO.</p>


  </div><a class="u-url" href="/DailyRead/2021/01/15/statically-configure-a-firewall-to-let-omg-dds-traffic-through.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/DailyRead/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">每日阅读</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">每日阅读</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
