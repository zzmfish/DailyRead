---
layout: posts
title: Linux awkå‘½ä»¤è¯¦è§£
tags: è½¯ä»¶å¼€å‘
---




## è°ƒç”¨æ–¹å¼

#### å‘½ä»¤è¡Œ

> awk [-F  field-separator]  'commands'  input-file(s)

#### å¯æ‰§è¡Œæ–‡ä»¶

å°†æ‰€æœ‰çš„awkå‘½ä»¤æ’å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä½¿awkç¨‹åºå¯æ‰§è¡Œï¼Œç„¶åawkå‘½ä»¤è§£é‡Šå™¨ä½œä¸ºè„šæœ¬çš„é¦–è¡Œï¼š

```
#!/bin/awk
```

#### è„šæœ¬æ–‡ä»¶

> awk -f awk-script-file input-file(s)

<center>ğŸ‰ğŸ‰ğŸ‰</center>

## å…¥é—¨å®ä¾‹

```bash
# æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·
awk -F ':' '{print $1}' /etc/passwd

# æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œå¯¹åº”çš„shellï¼ˆä»¥tabé”®åˆ†å‰²ï¼‰
awk -F ':' '{print $1"\t"$7}' /etc/passwd

# æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œå¯¹åº”çš„shellï¼ˆä»¥é€—å·åˆ†å‰²ï¼‰ï¼Œæ·»åŠ è¡Œå¤´name,shellï¼Œåœ¨æœ€åä¸€è¡Œæ·»åŠ "blue,/bin/nosh"
awk  -F ':'  'BEGIN {print "name,shell"}  {print $1","$7} END {print "blue,/bin/nosh"}' /etc/passwd

# æœç´¢/etc/passwdæœ‰rootçš„æ‰€æœ‰è¡Œ
awk -F: '/root/' /etc/passwd

# æœç´¢/etc/passwdæœ‰rootçš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„shell
awk -F: '/root/{print $7}' /etc/passwd
```

<center>ğŸ‰ğŸ‰ğŸ‰</center>

##  å†…ç½®å˜é‡

| å‚æ•° | è§£é‡Š |
| ---- | ---- |
| ARGC    |           å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•° |
| ARGV         |      å‘½ä»¤è¡Œå‚æ•°æ’åˆ— |
| ENVIRON       |     æ”¯æŒé˜Ÿåˆ—ä¸­ç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä½¿ç”¨ |
| FILENAME      |     awkæµè§ˆçš„æ–‡ä»¶å |
| FNR        |        æµè§ˆæ–‡ä»¶çš„è®°å½•æ•° |
| FS           |      è®¾ç½®è¾“å…¥åŸŸåˆ†éš”ç¬¦ï¼Œç­‰ä»·äºå‘½ä»¤è¡Œ -Fé€‰é¡¹ |
| NF         |        æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•° |
| NR         |        å·²è¯»çš„è®°å½•æ•° |
| OFS       |         è¾“å‡ºåŸŸåˆ†éš”ç¬¦ |
| ORS       |         è¾“å‡ºè®°å½•åˆ†éš”ç¬¦ |
| RS           |      æ§åˆ¶è®°å½•åˆ†éš”ç¬¦ |

<center>ğŸ‰ğŸ‰ğŸ‰</center>

## printå’Œprintf

```bash
# ç»Ÿè®¡/etc/passwd:æ–‡ä»¶åï¼Œæ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„åˆ—æ•°ï¼Œå¯¹åº”çš„å®Œæ•´è¡Œå†…å®¹
awk -F ':' '{print "filename:" FILENAME ",linenumber:" NR ",columns:" NF ",linecontent:"$0}' /etc/passwd

# ä½¿ç”¨printf
awk  -F ':' '{printf("filename:%10s,linenumber:%s,columns:%s,linecontent:%s\n", FILENAME, NR, NF, $0)}' /etc/passwd
```

<center>ğŸ‰ğŸ‰ğŸ‰</center>

## ç¼–ç¨‹

#### å˜é‡å’Œèµ‹å€¼

```bash
# ç»Ÿè®¡/etc/passwdçš„è´¦æˆ·äººæ•°ï¼ˆå˜é‡æ²¡æœ‰åˆå§‹åŒ–é»˜è®¤ä¸º0ï¼‰
awk '{count++;print $0;} END{print "user count is ", count}' /etc/passwd

# ç»Ÿè®¡æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°
ls -l | awk 'BEGIN {size=0;} {size=size+$5;} END{print "size is ", size}'

# ç»Ÿè®¡æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°ï¼ˆä»¥Mä¸ºå•ä½ï¼‰
ls -l | awk 'BEGIN {size=0;} {size=size+$5;} END{print "size is ", size/1024/1024,"M"}'
```



#### æ¡ä»¶è¯­å¥

```bash
# ç»Ÿè®¡æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°ï¼Œè¿‡æ»¤4096å¤§å°çš„æ–‡ä»¶ï¼ˆä¸€èˆ¬éƒ½æ˜¯æ–‡ä»¶å¤¹ï¼‰
ls -l |awk 'BEGIN {size=0} {if($5!=4096){size=size+$5;}} END{print "size is ", size/1024/1024,"M"}' 
```



#### å¾ªç¯è¯­å¥

#### æ•°ç»„

```bash
# æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·
awk -F ':' 'BEGIN {count=0;} {name[count] = $1;count++;}; END{for (i = 0; i < NR; i++) print i, name[i]}' /etc/passwd
```



[é˜…è¯»åŸæ–‡](https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html)